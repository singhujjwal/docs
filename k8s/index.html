<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>K8S Concepts - Cloud and Devops</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Cloud and Devops</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="active">
                                <a href="./">K8S Concepts</a>
                            </li>
                            <li >
                                <a href="../k8sadmin/">K8S Administraton</a>
                            </li>
                            <li >
                                <a href="../linux/">Linux</a>
                            </li>
                            <li >
                                <a href="../lin_command/">Linux Debugging</a>
                            </li>
                            <li >
                                <a href="../aws/">AWS</a>
                            </li>
                            <li >
                                <a href="../azure/">Azure</a>
                            </li>
                            <li >
                                <a href="../interviewquestions/">Interview</a>
                            </li>
                            <li >
                                <a href="../containers/">Containers</a>
                            </li>
                            <li >
                                <a href="../pdf/">PDFs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="disabled">
                                <a rel="next" >
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../k8sadmin/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#kubernetes-concepts">Kubernetes Concepts</a></li>
            <li><a href="#concepts">Concepts</a></li>
            <li><a href="#ingress">Ingress</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="kubernetes-concepts">Kubernetes Concepts</h1>
<h2 id="concepts">Concepts</h2>
<p>K8s objects are record of intent. Once you create it the kubernetes system takes care of making sure it is running all the time.
Object spec: What is constitutes
Object Status: Makes sure the status of the objects remains the same as defined in the status.</p>
<h3 id="pod">Pod</h3>
<p>A pod represents a running process on your  system sharing the same network (port and ip), storage. 
A pod enacapsulates an applicaton running in one or more containers, pods itself doesn’t heal, 
will need a deployment to get the self healing capability.</p>
<h3 id="services">Services</h3>
<p>A Kubernetes Service is an abstraction which defines a logical set of Pods and a policy by which to access them - sometimes called a micro-service. The set of Pods targeted by a Service is (usually) determined by a Label Selector.</p>
<p>Kubernetes also supports DNS SRV (service) records for named ports. If the "my-service.my-ns" Service has a port named "http" 
with protocol TCP, you can do a DNS SRV query for "_http._tcp.my-service.my-ns" to discover the port number for "http".
The Kubernetes DNS server is the only way to access services of type ExternalName</p>
<p>Kubernetes ServiceTypes allow you to specify what kind of service you want. The default is ClusterIP.
Type values and their behaviors are:</p>
<ol>
<li>ClusterIP: Exposes the service on a cluster-internal IP. Choosing this value makes the service only reachable from within the cluster. This is the default ServiceType.</li>
<li>NodePort: Exposes the service on each Node’s IP at a static port (the NodePort). A ClusterIP service, to which the NodePort service will route, is automatically created. You’ll be able to contact the NodePort service, from outside the cluster, by requesting <NodeIP>:<NodePort>.</li>
<li>LoadBalancer: Exposes the service externally using a cloud provider’s load balancer. NodePort and ClusterIP services, to which the external load balancer will route, are automatically created.</li>
<li>ExternalName: Maps the service to the contents of the externalName field (e.g. foo.bar.example.com), by returning a CNAME record with its value. No proxying of any kind is set up. This requires version 1.7 or higher of kube-dns.</li>
</ol>
<p>A loadbalancer is exteneded type of nodeport service where an external loadbalancer is created based on the cloud provider.</p>
<p>A loadbalancer will have a port mapping for the port LB is listening to the target port and the service name</p>
<p>Tcp can be patched to the nginx ingress controller loadbalancer by creating a config map and telling where in which namespace which service on which port to hit.</p>
<p>e.g. </p>
<pre><code class="yaml">
apiVersion: v1
kind: Service
metadata:
  name: tcp-echo
  labels:
    app: tcp-echo
spec:
  ports:
  - name: tcp
    port: 9000
  selector:
    app: tcp-echo
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tcp-echo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tcp-echo
      version: v1
  template:
    metadata:
      labels:
        app: tcp-echo
        version: v1
    spec:
      containers:
      - name: tcp-echo
        image: docker.io/istio/tcp-echo-server:1.1
        imagePullPolicy: IfNotPresent
        args: [ &quot;9000&quot;, &quot;hello&quot; ]
        ports:
        - containerPort: 9000


</code></pre>

<p>Below created the config map nginx-ingress-tcp while creating nginx load balancer</p>
<p>--set tcp.9000="my-system/tcp-echo:9000" \</p>
<h3 id="volumes">Volumes</h3>
<p>Types of volumes
* Local
* EBS
* azureDisk
* azureFile
* configMap
* emptyDir
* hostPath
* local
* nfs
* persistentVolumeClaim</p>
<p>Example of AWS EBS
1.  Create a volume first in the same zone as the node is present using command <code>aws ec2 create-volume --availability-zone=eu-west-1a --size=10 --volume-type=gp2</code>
2.  Use the below YAML to provide and ebs volume to a pod</p>
<pre><code class="yaml">  apiVersion: v1
  kind: Pod
  metadata:
    name: test-ebs
  spec:
    containers:
    - image: k8s.gcr.io/test-webserver
      name: test-container
      volumeMounts:
      - mountPath: /test-ebs
        name: test-volume
    volumes:
    - name: test-volume
      # This AWS EBS volume must already exist.
      awsElasticBlockStore:
        volumeID: &lt;volume-id&gt;
        fsType: ext4
</code></pre>

<ol>
<li>configMap is one of the very frequently used volume which is basically a key value store <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">details</a></li>
</ol>
<pre><code class="yaml">apiVersion: v1
kind: Pod
metadata:
  name: configmap-pod
spec:
  containers:
    - name: test
      image: busybox
      volumeMounts:
        - name: config-vol
          mountPath: /etc/config
  volumes:
    - name: config-vol
      configMap:
        name: log-config
        items:
          - key: log_level
            path: log_level
</code></pre>

<ol>
<li>projected : A projected volume maps several existing volume sources into the same directory. <a href="https://kubernetes.io/docs/concepts/storage/volumes/#projected">e.g.</a></li>
</ol>
<h4 id="persistent-volume">Persistent Volume</h4>
<p>A PersistentVolume (PV) is a piece of storage in the cluster that has been provisioned by an administrator or dynamically provisioned using Storage Classes. It is a resource in the cluster just like a node is a cluster resource. PVs are volume plugins like Volumes, but have a lifecycle independent of any individual Pod that uses the PV. This API object captures the details of the implementation of the storage, be that NFS, iSCSI, or a cloud-provider-specific storage system.</p>
<h4 id="persistent-volume-claim">Persistent Volume Claim</h4>
<p>A PersistentVolumeClaim (PVC) is a request for storage by a user. It is similar to a Pod. Pods consume node resources and PVCs consume PV resources. Pods can request specific levels of resources (CPU and Memory). Claims can request specific size and access modes (e.g., they can be mounted once read/write or many times read-only).
It can be static of dynamic, if a cluster admin has not created a PV explicitly a dynamic PV is created when a PVC is requested.</p>
<h4 id="storage-class">Storage Class</h4>
<h2 id="ingress">Ingress</h2>
<h3 id="nginx-ingress-controller">NGINX Ingress controller</h3>
<h4 id="exposing-tcp-port">Exposing TCP port</h4>
<p>You can expose a TCP port from an ingress-controller directly to outside world. It can be done by installing nginx with a <code>nginx-ingress-tcp</code> config map.
It gets created and USED only when is nginx is installed or upgraded # TBD come and revisit</p>
<p>so do a helm install <code>--set tcp.9000="plat-system/tcp-echo:9000"</code> with this or else
<code>helm upgrade</code> with all existing options and the above.
After that patch the configmap and the nginx service</p>
<p>ConfigMap as <code>configmap.yaml</code></p>
<pre><code class="yaml">data:
  &quot;31000&quot;: namespace/service:31000
</code></pre>

<p><code>kubectl patch configmaps nginx-ingress-tcp --namespace namespace --patch "$(cat configmap.yaml)"</code></p>
<p>Service patch as <code>service.yaml</code></p>
<pre><code class="yaml">spec:
  ports:
  - name: service-31000
    port: 31000
    protocol: TCP
    targetPort: 31000
</code></pre>

<p>As you can see name <code>service-31000</code> doesn't matter.</p>
<p><code>kubectl patch services nginx-ingress-controller --namespace namespace --patch "$(cat service.yaml)"</code></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
